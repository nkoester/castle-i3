# This file has been auto-generated by i3-config-wizard(1).
# It will not be overwritten, so edit it as you like.
#
# Should you change your keyboard layout somewhen, delete
# this file and re-run i3-config-wizard(1).
#

# i3 config file (v4)
#
# Please see http://i3wm.org/docs/userguide.html for a complete reference!

set $mod Mod4
set $alt Mod1
set $smallstep 2
set $bigstep 30

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below. ISO 10646 = Unicode
#font -misc-fixed-medium-r-normal--13-120-75-75-C-70-iso10646-1
# The font above is very space-efficient, that is, it looks good, sharp and
# clear in small sizes. However, if you need a lot of unicode glyphs or
# right-to-left text rendering, you should instead use pango for rendering and
# chose a FreeType font, such as:
font pango:DejaVu Sans Mono 10

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# start a terminal
bindsym $mod+Return exec i3-sensible-terminal

# kill focused window
#bindsym $mod+Shift+q kill
bindsym $alt+F4 kill
bindsym $mod+q kill

# start dmenu (a program launcher)
#bindsym $mod+space exec dmenu_run -p "run >> "
bindsym $mod+space exec rofi -show run

bindsym $mod+c exec leo_search_rofi.sh
# bindsym $mod+c exec --no-startup-id "rofi -show calc -modi calc -no-show-match -no-sort"
# bindsym $mod+c exec --no-startup-id "rofi -show calc -modi calc -no-show-match -no-sort -calc-command \"echo '{result}' | xclip\""

# todo: readd this?
# bindsym $mod+s exec rofi -show ssh
bindsym $mod+s exec teiler

bindsym Ctrl+Shift+Tab exec rofi -show window
# bindsym $mod+space exec dmenu_run -fn 'DejaVu Sans Mono:bold:pixelsize=40' -p "run >> " -l 7
#bindsym $mod+d exec --no-startup-id i3-dmenu-desktop

# change focus
bindsym $mod+j focus left
bindsym $mod+k focus down
bindsym $mod+l focus up
bindsym $mod+semicolon focus right

# alternatively, you can use the cursor keys:
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# move focused window
bindsym $mod+Shift+j move left $bigstep
bindsym $mod+Shift+k move down $bigstep
bindsym $mod+Shift+l move up $bigstep
bindsym $mod+Shift+semicolon move right $bigstep

bindsym $mod+Shift+$alt+j move left $smallstep
bindsym $mod+Shift+$alt+k move down $smallstep
bindsym $mod+Shift+$alt+l move up $smallstep
bindsym $mod+Shift+$alt+semicolon move right $smallstep

# alternatively, you can use the cursor keys:
#bindsym $mod+Shift+Left move left
#bindsym $mod+Shift+Down move down
#bindsym $mod+Shift+Up move up
#bindsym $mod+Shift+Right move right

# split in horizontal orientation
bindsym $mod+h split h

# split in vertical orientation
bindsym $mod+v split v

# enter fullscreen mode for the focused container
bindsym $mod+f fullscreen

# change container layout (stacked, tabbed, toggle split)
# not really used ...
# bindsym $mod+s layout stacking
bindsym $mod+t layout tabbed
bindsym $mod+e layout toggle split

# toggle tiling / floating
bindsym $mod+w floating toggle

# so this does not work .. why?
#bindsym $mod+Button1 floating toggle
#bindsym $mod+Button4 shrink width 20 px or 20 ppt

# change focus between tiling / floating windows
bindsym $alt+Tab focus mode_toggle

# focus the parent container -- this is now used instead of alt+f4
bindsym $mod+a focus parent

# focus the child container
bindsym $mod+d focus child

# workspaces
set $workspace_1       "1:mail"
set $workspace_2       "2:www"
set $workspace_3       "3:term"
set $workspace_4       "4:ide"
set $workspace_5       "5"
set $workspace_6       "6:log"
set $workspace_7       "7"
set $workspace_8       "8"
set $workspace_9       "9:www"
set $workspace_10      "10:stat"

# switch to workspace
bindsym $mod+1 workspace $workspace_1
bindsym $mod+2 workspace $workspace_2
bindsym $mod+3 workspace $workspace_3
bindsym $mod+4 workspace $workspace_4
bindsym $mod+5 workspace $workspace_5
bindsym $mod+6 workspace $workspace_6
bindsym $mod+7 workspace $workspace_7
bindsym $mod+8 workspace $workspace_8
bindsym $mod+9 workspace $workspace_9
bindsym $mod+0 workspace $workspace_10

bindsym $mod+$alt+semicolon workspace next
bindsym $mod+$alt+j workspace prev
# open a blank new workspace, where ever possible
bindsym $d +ctrl+Return exec --no-startup-id ~/.i3/open_empty_workspace.sh

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace $workspace_1
bindsym $mod+Shift+2 move container to workspace $workspace_2
bindsym $mod+Shift+3 move container to workspace $workspace_3
bindsym $mod+Shift+4 move container to workspace $workspace_4
bindsym $mod+Shift+5 move container to workspace $workspace_5
bindsym $mod+Shift+6 move container to workspace $workspace_6
bindsym $mod+Shift+7 move container to workspace $workspace_7
bindsym $mod+Shift+8 move container to workspace $workspace_8
bindsym $mod+Shift+9 move container to workspace $workspace_9
bindsym $mod+Shift+0 move container to workspace $workspace_10

# reload the configuration file
bindsym $mod+Shift+c reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart
# exit i3 (logs you out of your X session)
#bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"
bindsym $mod+Shift+e exec sh -c '[ $(echo -e "NO\nYES" | dmenu -sb "#ff6600" -i -p "Really exit i3 X session?") = "YES" ] && i3-msg exit'

# resize window (you can also use the mouse for that)
mode "resize" {
        # These bindings trigger as soon as you enter the resize mode

        # Pressing left will shrink the window’s width.
        # Pressing right will grow the window’s width.
        # Pressing up will shrink the window’s height.
        # Pressing down will grow the window’s height.
        bindsym j resize shrink width 20 px or 20 ppt
        bindsym k resize grow height 20 px or 20 ppt
        bindsym l resize shrink height 20 px or 20 ppt
        bindsym semicolon resize grow width 20 px or 20 ppt

        bindsym $alt+j resize shrink width 2 px or 2 ppt
        bindsym $alt+k resize grow height 2 px or 2 ppt
        bindsym $alt+l resize shrink height 2 px or 2 ppt
        bindsym $alt+semicolon resize grow width 2 px or 2 ppt

        # back to normal: Enter or Escape
        bindsym Return mode "default"
        bindsym Escape mode "default"
}

bindsym $mod+r mode "resize"

# own

exec_always --no-startup-id $HOME/.i3/launchpolybar.sh

# Start i3bar to display a workspace bar (plus the system information i3status
# finds out, if available)
exec_always --no-startup-id $HOME/.i3/launchPolybar.sh

#colors:                border  backgr. text    indicator
#client.focused          #007030 #007030 #ffffff #2b2b2b
#client.focused_inactive #888888 #2b2b2b #ffffff #2b2b2b
#client.unfocused        #888888 #2b2b2b #ffffff #2b2b2b
#client.urgent           #900000 #900000 #ffffff #2b2b2b


# Hybrid colors
set $back               #1d1F21
set $black              #282A2E
set $grey               #373B41
set $lightergrey          #a9aeb2
set $lightgrey          #707880
set $white              #C5C8C6
set $yellow             #F0C674
set $red                #CC6666
set $darkred            #A54242
set $green              #B5BD56
set $greennew           #dbdfad
set $lr #FF3333
set $orange             #E59400

#class                  border      backgr.  text          split
client.focused          $greennew   $orange $black        $lr
client.focused_inactive $grey       $grey    $lightgrey    $grey
client.unfocused        $lightgrey  $grey    $lightergrey  $grey
client.urgent           $red        $red     $black        $red
client.background       $back


client.placeholder      #000000 #0c0c0c #ffffff #000000   #0c0c0c
#client.background       #ffffff



# disable auto focus
focus_follows_mouse no
mouse_warping none

# no borders on the eges of the screen
hide_edge_borders both

workspace_auto_back_and_forth yes

bindsym $mod+n exec i3-input -F 'rename workspace to "%s"' -P 'Rename workspace: '

# audio keys
bindsym XF86AudioMicMute exec pactl set-source-mute @DEFAULT_SOURCE@ toggle
bindsym XF86AudioMute exec pactl set-sink-mute @DEFAULT_SINK@ toggle

bindsym $alt+XF86AudioRaiseVolume exec pactl set-sink-volume @DEFAULT_SINK@ +1% && notify-send -t 1500 -h string:x-canonical-private-synchronous:vol "Volume: +1% to $(pulseaudio-ctl full-status | cut -d " " -f 1)%"
bindsym $alt+XF86AudioLowerVolume exec pactl set-sink-volume @DEFAULT_SINK@ -1% && notify-send -t 1500 -h string:x-canonical-private-synchronous:vol "Volume: -1% to $(pulseaudio-ctl full-status | cut -d " " -f 1)%"
bindsym XF86AudioRaiseVolume exec pactl set-sink-volume @DEFAULT_SINK@ +5% && notify-send -t 1500 -h string:x-canonical-private-synchronous:vol "Volume: +5% to $(pulseaudio-ctl full-status | cut -d " " -f 1)%"
bindsym XF86AudioLowerVolume exec pactl set-sink-volume @DEFAULT_SINK@ -5% && notify-send -t 1500 -h string:x-canonical-private-synchronous:vol "Volume: -5% to $(pulseaudio-ctl full-status | cut -d " " -f 1)%"

# Media player controls
bindsym XF86AudioPlay exec playerctl play
bindsym XF86AudioPause exec playerctl pause
bindsym XF86AudioNext exec playerctl next
bindsym XF86AudioPrev exec playerctl previous


# bindsym XF86AudioMicMute exec /usr/bin/pulseaudio-ctl mute-input
# bindsym XF86AudioMute exec /usr/bin/pulseaudio-ctl mute
# bindsym XF86AudioRaiseVolume exec /usr/bin/pulseaudio-ctl up
# bindsym XF86AudioLowerVolume exec /usr/bin/pulseaudio-ctl down


#bindsym XF86AudioRaiseVolume exec amixer -q set Master 2%+ unmute && notify-send -t 1 "Volume (+2dB): " `amixer get Master | grep -oE "\[[0-9]+\%\]" | head -n 1`
#bindsym XF86AudioLowerVolume exec amixer -q set Master 2%- unmute && notify-send -t 1 "Volume (-2dB): " `amixer get Master | grep -oE "\[[0-9]+\%\]" | head -n 1`
#bindsym XF86AudioMute exec amixer -q -D pulse set Master toggle && notify-send -t 1 "Volume (MUTED): " `amixer get Master | grep -oE "(\[(on|off)+\])" | head -n 1`


# bindsym XF86AudioRaiseVolume exec amixer -q set Master 2%+ unmute && notify-send.sh --replace=1 -t 1 "Volume (+2dB): " `amixer get Master | grep -oE "\[[0-9]+\%\]" | head -n 1`
# bindsym XF86AudioLowerVolume exec amixer -q set Master 2%- unmute && notify-send.sh --replace=1 -t 1 "Volume (-2dB): " `amixer get Master | grep -oE "\[[0-9]+\%\]" | head -n 1`
# bindsym XF86AudioMute exec amixer -q -D pulse set Master toggle && notify-send.sh --replace=1 -t 1 "Volume (MUTED): " `amixer get Master | grep -oE "(\[(on|off)+\])" | head -n 1`


#lockscreen
exec "/usr/bin/xscreensaver -no-splash"
exec "xss-lock -- xscreensaver-command -lock"
bindsym ctrl+$alt+l exec "/usr/bin/xscreensaver-command -lock"

# trays
exec `which dunst`
exec "/usr/bin/volumeicon"
exec "which `nm-applet`"
exec "which `fluxgui`"
# exec "/usr/bin/picom --config /home/nkoester/.i3/compton.conf"
# exec "/usr/bin/picom -CG --config /home/nkoester/.i3/compton.conf"

# background
exec --no-startup-id setwallpaper.sh
bindsym $mod+b exec --no-startup-id setwallpaper.sh

# Disable Nautilus desktop.
exec "gconftool-2 -s -t bool /apps/nautilus/preferences/show_desktop false"
# # Do not let Nautilus set the background image.
exec "gconftool-2 -s -t bool /desktop/gnome/background/draw_background false"
# Make Nautilus use spatial mode, should start-up quicker.
exec "gconftool-2 -s -t bool /apps/nautilus/preferences/always_use_browser false"
# Make Nautilus show the advanced permissions dialog
exec "gconftool-2 -s -t bool /apps/nautilus/preferences/show_advanced_permissions true"

# make sure the keyboard is set to us
exec "setxkbmap us"

bindsym ctrl+$mod+$alt+space exec --no-startup-id "$HOME/local/bin/toggle_keyboardlayout.sh"

# password autotype binding
bindsym $mod+o exec "$HOME/local/bin/passotpmenu --type -nb black -nf white -sb black -sf orange -b"
bindsym $mod+Shift+o exec "$HOME/local/bin/passotpmenu --type --slow -nb black -nf white -sb black -sf orange -b"

bindsym $mod+p exec "$HOME/local/bin/passmenu --type -nb black -nf white -sb black -sf orange -b"
bindsym $mod+Shift+p exec "$HOME/local/bin/passmenu --type --slow -nb black -nf white -sb black -sf orange -b"
exec /usr/bin/blueberry-tray

set $mode_cpu_governor CPU governor setting: (p) performance, wow! (o) powersave
mode "$mode_cpu_governor" {
    # works for: x230
    bindsym p exec --no-startup-id sudo cpupower frequency-set -g performance, mode "default"
    bindsym o exec --no-startup-id sudo cpupower frequency-set -g powersave, mode "default"
    # back to normal: Enter or Escape
    bindsym Return mode "default"
    bindsym Escape mode "default"
}

bindsym $mod+u mode "$mode_parmigiano_nfs"
set $mode_parmigiano_nfs Handle parmigiano NFS paths: (m) mount, (r) remount (u) umount
mode "$mode_parmigiano_nfs" {
    # works for: x230
    bindsym m exec --no-startup-id termite --class="non-interactive-helper-script" --title="parmigiano-mount" -e "parmigianoMount.sh m", mode "default"
    bindsym r exec --no-startup-id termite --class="non-interactive-helper-script" --title="parmigiano-mount" -e "parmigianoMount.sh r", mode "default"
    bindsym u exec --no-startup-id termite --class="non-interactive-helper-script" --title="parmigiano-mount" -e "parmigianoMount.sh u", mode "default"
    # back to normal: Enter or Escape
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+g mode "$mode_cpu_governor"


###
# MULTI SCREEN SETTINGS
###

# TODO replace with
# xbacklight -inc 5
## Manual management of external displays
bindsym XF86MonBrightnessDown exec /usr/bin/brightnessctl s 5%- && notify-send -t 400 "Brightness $(/usr/bin/xbacklight -get)"
bindsym XF86MonBrightnessUp exec /usr/bin/brightnessctl s +5% && notify-send -t 400 "Brightness $(/usr/bin/xbacklight -get)"
# bindsym XF86MonBrightnessUp   exec /usr/bin/brightnessctl s +5%


bindsym $alt+$mod+ctrl+0 exec /home/nkoester/.screenlayout/office2.sh
bindsym $alt+$mod+ctrl+9 exec /home/nkoester/.screenlayout/mobile2.sh

# xrandr the screen setup
#exec `which xrandr_techfak.sh`

## Manual management of external displays
set $mode_display Screen Setup: (m) mobile, (d) dock, extend (r) right, (l) left, (t) top (b) bottom [(w) transfer workspaces]

mode "$mode_display" {

    # works for: x230
    bindsym m exec --no-startup-id  xrandr_mobile_lvds.sh && \
                                    setwallpaper.sh && \
                                    selectPreviousWorkspace.sh && \
                                    /home/nkoester/.i3/launchpolybar.sh && \
                                    sudo cpupower frequency-set -g powersave && \
                                    /usr/bin/brightnessctl s 20% && \
                                    /usr/bin/nmcli radio wifi on && \
                                    notify-send -t 400 "Brightness $(/usr/bin/xbacklight -get)" \
                                    , mode "default"
    bindsym d exec --no-startup-id  mons -e right && \
                                    setwallpaper.sh && \
                                    /home/nkoester/.i3/launchpolybar.sh && \
                                    transferWorkspaces.sh && \
                                    selectPreviousWorkspace.sh && \
                                    sudo cpupower frequency-set -g performance && \
                                    /usr/bin/brightnessctl s 1% && \
                                    /usr/bin/nmcli radio wifi off && \
                                    notify-send -t 400 "Brightness $(/usr/bin/xbacklight -get)" \
                                    , mode "default"
    bindsym r exec --no-startup-id  mons -e right && \
                                    setwallpaper.sh && \
                                    /home/nkoester/.i3/launchpolybar.sh \
                                    , mode "default"
    bindsym l exec --no-startup-id  mons -e left && \
                                    setwallpaper.sh && \
                                    /home/nkoester/.i3/launchpolybar.sh \
                                    , mode "default"
    bindsym t exec --no-startup-id  mons -e top && \
                                    setwallpaper.sh && \
                                    /home/nkoester/.i3/launchpolybar.sh \
                                    , mode "default"
    bindsym b exec --no-startup-id  mons -e bottom && \
                                    setwallpaper.sh && \
                                    /home/nkoester/.i3/launchpolybar.sh \
                                    , mode "default"

    bindsym w exec --no-startup-id  transferWorkspaces.sh \
                                    && selectPreviousWorkspace.sh\
                                    , mode "default"

    # back to normal: Enter or Escape
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+m mode "$mode_display"; exec --no-startup-id rememberCurrentWorkspace.sh

# moving to other outputs
bindsym $mod+z move workspace to output right
bindsym $mod+ctrl+$alt+j move workspace to output left
bindsym $mod+ctrl+$alt+semicolon move workspace to output right
bindsym $mod+ctrl+$alt+k move workspace to output above
bindsym $mod+ctrl+$alt+l move workspace to output below

# change focus between outputs
bindsym $mod+ctrl+j focus output left
bindsym $mod+ctrl+semicolon focus output right
bindsym $mod+ctrl+k focus output above
bindsym $mod+ctrl+l focus output below




# Bindings
bindsym $mod+$alt+n exec "/home/nkoester/local/bin/restartnmapplet.sh"
bindsym $mod+$alt+b exec "/home/nkoester/local/bin/connectBluetoothHeadset.sh"

# i3 gaps
for_window [class="^.*"] border pixel 2
# gaps inner 0
gaps inner 2
gaps outer 0
#smart_borders on


# pinentry gpg
for_window [class="Pinentry"] floating enable, border none


# window-specific rules
for_window [window_role="pop-up"] floating enable
for_window [window_role="task_dialog"] floating enable
for_window [class="^XCalc$"] floating enable
for_window [class="^Galculator$"] floating enable
for_window [class="^Steam$"] floating enable; border none

for_window [class="Pavucontrol" instance="pavucontrol" title="Volume Control"] floating enable
for_window [class="Blueman-manager" instance="blueman-manager" title="Bluetooth Devices"] floating enable
# gnome calc
for_window [class="^Gnome-calculator$"] floating enable; border none

# Fix jetbrains MPS code completion windos with this <3
# for_window [class="jetbrains-mps-ce"] border none
#for_window [title="win\d"] border none

# person id windows
for_window [class="^ID Recognition$"] floating enable

# remote desktop window
for_window [class="^xfreerdp$"] floating enable

# thunderbird compose message window
for_window [window_role="conversation"] floating enable, border normal
for_window [window_role="Msgcompose"] floating enable, border normal


for_window [class="Grabbed Image"] floating enable, border normal

# csra screen utils
for_window [class="^Progress$"] floating enable, border normal
for_window [class="Csra-on-screen-progress" instance="csra-on-screen-progress$"] floating enable, border normal
for_window [class="Csra-on-screen-keyboard" instance="csra-on-screen-keyboard$"] floating enable, border normal

# vdemo
for_window [class="^XTerm$" title="^.*detach by [C-a d].*$"] floating enable, border normal; resize grow height 400px; resize grow width 600px; #move down 100px 202px
for_window [class="Vdemo2_controller.tcl" title="vdemo2_controller.tcl"] floating enable, border normal
#for_window [class="^XTerm$"] floating enable, border normal

# cssh
for_window [class="^Cssh$"] floating enable, border normal

for_window [title="ID Recognition State"] floating enable, border normal
for_window [title="ID Recognition"] floating enable, border normal

# VMs
for_window [class="Spicy"] border pixel 1

# wine
for_window [class="Wine" title="Default - Wine desktop"] floating enable, border normal
for_window [class="Wine" title="wine"] floating enable, border normal

for_window [class="de.citec.csra.mapfx3.MapLoader"] floating enable, border normal

# on login ...
# exec --no-startup-id i3-msg 'workspace 1:mail; exec /usr/bin/thunderbird'
# exec --no-startup-id i3-msg 'workspace 2:www; exec /usr/bin/firefox'
# exec --no-startup-id i3-msg 'workspace 3:term; exec termite;'
# exec --np-startup-id i3-msg 'workspace 10:stat; exec psensor'
# exec --np-startup-id i3-msg 'workspace 10:stat; exec termite -e "dmesg -Twx"'
exec --no-startup-id i3-msg 'workspace 2:www; exec /usr/bin/firefox'
exec --no-startup-id i3-msg 'workspace 3:term; exec termite;'
# exec --np-startup-id i3-msg 'workspace 10:stat; exec psensor'
# exec --np-startup-id i3-msg 'workspace 10:stat; exec termite -e "dmesg -Twx"'

for_window [class="Vmg" instance="vmg" title="Magnifying Glass"] floating enable, border none
# bindsym $mod+m exec vmg



# helper scripts
for_window [class="non-interactive-helper-script"] floating enable, border pixel 1, resize set 1000px 500px, move position center
